[ema@testlab:atelier-04] $ vagrant up
Bringing machine 'debian' up with 'virtualbox' provider...
Bringing machine 'rocky' up with 'virtualbox' provider...
==> debian: Importing base box 'generic/debian12'...
==> debian: Matching MAC address for NAT networking...
==> debian: Checking if box 'generic/debian12' version '4.3.12' is up to date...
==> debian: Setting the name of the VM: atelier-04_debian_1742808696707_65553
==> debian: Clearing any previously set network interfaces...
==> debian: Preparing network interfaces based on configuration...
    debian: Adapter 1: nat
    debian: Adapter 2: hostonly
==> debian: Forwarding ports...
    debian: 22 (guest) => 2222 (host) (adapter 1)
==> debian: Running 'pre-boot' VM customizations...
==> debian: Booting VM...
==> debian: Waiting for machine to boot. This may take a few minutes...
    debian: SSH address: 127.0.0.1:2222
    debian: SSH username: vagrant
    debian: SSH auth method: private key
    debian: 
    debian: Vagrant insecure key detected. Vagrant will automatically replace
    debian: this with a newly generated keypair for better security.
    debian: 
    debian: Inserting generated public key within guest...
    debian: Removing insecure key from the guest if it's present...
    debian: Key inserted! Disconnecting and reconnecting using new SSH key...
==> debian: Machine booted and ready!
==> debian: Setting hostname...
==> debian: Configuring and enabling network interfaces...
==> debian: Mounting shared folders...
    debian: /home/ema/formation-ansible/atelier-04 => /vagrant
==> rocky: Importing base box 'generic/rocky9'...
==> rocky: Matching MAC address for NAT networking...
==> rocky: Checking if box 'generic/rocky9' version '4.3.12' is up to date...
==> rocky: Setting the name of the VM: atelier-04_rocky_1742808749050_24190
==> rocky: Fixed port collision for 22 => 2222. Now on port 2200.
==> rocky: Clearing any previously set network interfaces...
==> rocky: Preparing network interfaces based on configuration...
    rocky: Adapter 1: nat
    rocky: Adapter 2: hostonly
==> rocky: Forwarding ports...
    rocky: 22 (guest) => 2200 (host) (adapter 1)
==> rocky: Running 'pre-boot' VM customizations...
==> rocky: Booting VM...
==> rocky: Waiting for machine to boot. This may take a few minutes...
    rocky: SSH address: 127.0.0.1:2200
    rocky: SSH username: vagrant
    rocky: SSH auth method: private key
    rocky: 
    rocky: Vagrant insecure key detected. Vagrant will automatically replace
    rocky: this with a newly generated keypair for better security.
    rocky: 
    rocky: Inserting generated public key within guest...
    rocky: Removing insecure key from the guest if it's present...
    rocky: Key inserted! Disconnecting and reconnecting using new SSH key...
==> rocky: Machine booted and ready!
==> rocky: Setting hostname...
==> rocky: Configuring and enabling network interfaces...
==> rocky: Mounting shared folders...
    rocky: /home/ema/formation-ansible/atelier-04 => /vagrant
==> rocky: Running provisioner: shell...
    rocky: Running: /tmp/vagrant-shell20250324-35914-7eyr4q.sh
    rocky: Dependencies resolved.
    rocky: ================================================================================
    rocky:  Package               Architecture    Version           Repository        Size
    rocky: ================================================================================
    rocky: Removing:
    rocky:  epel-release          noarch          9-7.el9           @extras           26 k
    rocky: 
    rocky: Transaction Summary
    rocky: ================================================================================
    rocky: Remove  1 Package
    rocky: 
    rocky: Freed space: 26 k
    rocky: Running transaction check
    rocky: Transaction check succeeded.
    rocky: Running transaction test
    rocky: Transaction test succeeded.
    rocky: Running transaction
    rocky:   Preparing        :                                                        1/1
    rocky:   Erasing          : epel-release-9-7.el9.noarch                            1/1
    rocky: warning: /etc/yum.repos.d/epel.repo saved as /etc/yum.repos.d/epel.repo.rpmsave
    rocky: warning: /etc/yum.repos.d/epel-testing.repo saved as /etc/yum.repos.d/epel-testing.repo.rpmsave
    rocky: 
    rocky:   Verifying        : epel-release-9-7.el9.noarch                            1/1
    rocky: 
    rocky: Removed:
    rocky:   epel-release-9-7.el9.noarch
    rocky: 
    rocky: Complete!
[ema@testlab:atelier-04] $ vagrant ssh debian
vagrant@debian:~$ sudo apt update
Get:1 http://deb.debian.org/debian bookworm InRelease [151 kB]
Get:2 http://security.debian.org/debian-security bookworm-security InRelease [48.0 kB]
Get:3 http://deb.debian.org/debian bookworm-updates InRelease [55.4 kB]
Get:4 http://security.debian.org/debian-security bookworm-security/main Sources [147 kB]
Get:5 http://deb.debian.org/debian bookworm/main Sources [9,495 kB]
Get:6 http://security.debian.org/debian-security bookworm-security/main amd64 Packages [250 kB]
Get:7 http://security.debian.org/debian-security bookworm-security/main Translation-en [150 kB]
Get:8 http://deb.debian.org/debian bookworm-updates/main Sources.diff/Index [15.1 kB]     
Ign:8 http://deb.debian.org/debian bookworm-updates/main Sources.diff/Index
Get:9 http://deb.debian.org/debian bookworm-updates/main amd64 Packages.diff/Index [15.1 kB]
Ign:9 http://deb.debian.org/debian bookworm-updates/main amd64 Packages.diff/Index
Get:10 http://deb.debian.org/debian bookworm-updates/main Translation-en.diff/Index [15.1 kB]
Ign:10 http://deb.debian.org/debian bookworm-updates/main Translation-en.diff/Index
Get:11 http://deb.debian.org/debian bookworm/non-free-firmware Sources [6,440 B]
Get:12 http://deb.debian.org/debian bookworm/main amd64 Packages [8,792 kB]
Get:13 http://deb.debian.org/debian bookworm/main Translation-en [6,109 kB]
Get:14 http://deb.debian.org/debian bookworm/non-free-firmware amd64 Packages [6,240 B]
Get:15 http://deb.debian.org/debian bookworm/non-free-firmware Translation-en [20.9 kB]
Get:16 http://deb.debian.org/debian bookworm-updates/non-free-firmware Sources [2,076 B]
Get:17 http://deb.debian.org/debian bookworm-updates/non-free-firmware amd64 Packages [616 B]
Get:18 http://deb.debian.org/debian bookworm-updates/non-free-firmware Translation-en [384 B]
Get:19 http://deb.debian.org/debian bookworm-updates/main Sources [16.2 kB]
Get:20 http://deb.debian.org/debian bookworm-updates/main amd64 Packages [13.5 kB]
Get:21 http://deb.debian.org/debian bookworm-updates/main Translation-en [16.0 kB]
Fetched 25.3 MB in 3s (9,678 kB/s)                            
Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
95 packages can be upgraded. Run 'apt list --upgradable' to see them.
N: Repository 'http://deb.debian.org/debian bookworm InRelease' changed its 'Version' value from '12.4' to '12.10'
vagrant@debian:~$ sudo apt install -y direnv
Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
The following NEW packages will be installed:
  direnv
0 upgraded, 1 newly installed, 0 to remove and 95 not upgraded.
Need to get 2,233 kB of archives.
After this operation, 6,706 kB of additional disk space will be used.
Get:1 http://deb.debian.org/debian bookworm/main amd64 direnv amd64 2.32.1-2+b4 [2,233 kB]
Fetched 2,233 kB in 0s (4,711 kB/s)
Selecting previously unselected package direnv.
(Reading database ... 60505 files and directories currently installed.)
Preparing to unpack .../direnv_2.32.1-2+b4_amd64.deb ...
Unpacking direnv (2.32.1-2+b4) ...
Setting up direnv (2.32.1-2+b4) ...
Processing triggers for man-db (2.11.2-2) ...
vagrant@debian:~$ echo 'eval "$(direnv hook bash)"' >> ~/.bashrc
vagrant@debian:~$ source ~/.bashrc
vagrant@debian:~$ mkdir -v monprojet
mkdir: created directory 'monprojet'
vagrant@debian:~$ cd monprojet/
vagrant@debian:~/monprojet$ pwd
/home/vagrant/monprojet
vagrant@debian:~/monprojet$ echo "export TESTVAR=Yatahongaga" > .envrc
direnv: error /home/vagrant/monprojet/.envrc is blocked. Run `direnv allow` to approve its content
vagrant@debian:~/monprojet$ direnv allow
direnv: loading ~/monprojet/.envrc
direnv: export +TESTVAR
vagrant@debian:~/monprojet$ echo "export TESTVAR=Yatahongaga" > .envrc
direnv: loading ~/monprojet/.envrc
direnv: export +TESTVAR
vagrant@debian:~/monprojet$ echo $TESTVAR
Yatahongaga
vagrant@debian:~/monprojet$ cd 
direnv: unloading
vagrant@debian:~$ echo $TESTVAR

vagrant@debian:~$ cd monprojet/
direnv: loading ~/monprojet/.envrc
direnv: export +TESTVAR
vagrant@debian:~/monprojet$ direnv allow
direnv: loading ~/monprojet/.envrc
direnv: export +TESTVAR
vagrant@debian:~/monprojet$ echo $TESTVAR
Yatahongaga
vagrant@debian:~/monprojet$ echo 'export ANSIBLE_CONFIG=$(expand_path ansible.cfg)' > .envrc 
direnv: error /home/vagrant/monprojet/.envrc is blocked. Run `direnv allow` to approve its content
vagrant@debian:~/monprojet$ direnv allow
direnv: loading ~/monprojet/.envrc
direnv: export +ANSIBLE_CONFIG
vagrant@debian:~/monprojet$ echo 'export ANSIBLE_CONFIG=$(expand_path ansible.cfg)' > .envrc 
direnv: loading ~/monprojet/.envrc
direnv: export +ANSIBLE_CONFIG
vagrant@debian:~/monprojet$ echo $ANSIBLE_CONFIG
/home/vagrant/monprojet/ansible.cfg
vagrant@debian:~/monprojet$ mkdir -v sousrepertoire
mkdir: created directory 'sousrepertoire'
vagrant@debian:~/monprojet$ cd sousrepertoire/
vagrant@debian:~/monprojet/sousrepertoire$ echo $ANSIBLE_CONFIG
/home/vagrant/monprojet/ansible.cfg
vagrant@debian:~/monprojet/sousrepertoire$ exit
logout
Connection to 127.0.0.1 closed.
[ema@testlab:atelier-04] $ 
[ema@testlab:atelier-04] $ vagrant ssh rocky
[vagrant@rocky ~]$ VERSION="2.35.0"
[vagrant@rocky ~]$ sudo wget https://github.com/direnv/direnv/releases/download/v$VERSION/direnv.linux-amd64 \
  -O /usr/local/bin/direnv
--2025-03-24 09:35:34--  https://github.com/direnv/direnv/releases/download/v2.35.0/direnv.linux-amd64
Resolving github.com (github.com)... 140.82.121.4
Connecting to github.com (github.com)|140.82.121.4|:443... connected.
HTTP request sent, awaiting response... 302 Found
Location: https://objects.githubusercontent.com/github-production-release-asset-2e65be/1219305/a26ae894-37af-4662-b55b-aef71ac375ad?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=releaseassetproduction%2F20250324%2Fus-east-1%2Fs3%2Faws4_request&X-Amz-Date=20250324T093534Z&X-Amz-Expires=300&X-Amz-Signature=5fcc072bc846283cef7959a0d4700cabf8805ec9f94e401ae9675df02482f34e&X-Amz-SignedHeaders=host&response-content-disposition=attachment%3B%20filename%3Ddirenv.linux-amd64&response-content-type=application%2Foctet-stream [following]
--2025-03-24 09:35:34--  https://objects.githubusercontent.com/github-production-release-asset-2e65be/1219305/a26ae894-37af-4662-b55b-aef71ac375ad?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=releaseassetproduction%2F20250324%2Fus-east-1%2Fs3%2Faws4_request&X-Amz-Date=20250324T093534Z&X-Amz-Expires=300&X-Amz-Signature=5fcc072bc846283cef7959a0d4700cabf8805ec9f94e401ae9675df02482f34e&X-Amz-SignedHeaders=host&response-content-disposition=attachment%3B%20filename%3Ddirenv.linux-amd64&response-content-type=application%2Foctet-stream
Resolving objects.githubusercontent.com (objects.githubusercontent.com)... 185.199.108.133, 185.199.109.133, 185.199.110.133, ...
Connecting to objects.githubusercontent.com (objects.githubusercontent.com)|185.199.108.133|:443... connected.
HTTP request sent, awaiting response... 200 OK
Length: 6934528 (6.6M) [application/octet-stream]
Saving to: ‘/usr/local/bin/direnv’

/usr/local/bin/direnv        100%[==============================================>]   6.61M  15.1MB/s    in 0.4s    

2025-03-24 09:35:35 (15.1 MB/s) - ‘/usr/local/bin/direnv’ saved [6934528/6934528]

[vagrant@rocky ~]$ sudo chmod 0755 /usr/local/bin/direnv
[vagrant@rocky ~]$ echo 'eval "$(direnv hook bash)"' >> ~/.bashrc
[vagrant@rocky ~]$ source ~/.bashrc
[vagrant@rocky ~]$ mkdir test
[vagrant@rocky ~]$ cd test/
[vagrant@rocky test]$ pwd
/home/vagrant/test
[vagrant@rocky test]$ echo "export TESTVAR=Yatahongaga" > .envrc
direnv: error /home/vagrant/test/.envrc is blocked. Run `direnv allow` to approve its content
[vagrant@rocky test]$ direnv allow
direnv: loading ~/test/.envrc
direnv: export +TESTVAR
[vagrant@rocky test]$ echo $TESTVAR
Yatahongaga
[vagrant@rocky test]$ cd 
direnv: unloading
[vagrant@rocky ~]$ exit
logout
Connection to 127.0.0.1 closed.
[ema@testlab:atelier-04] $ vagrant destroy -f
==> rocky: Forcing shutdown of VM...
==> rocky: Destroying VM and associated drives...
==> debian: Forcing shutdown of VM...
==> debian: Destroying VM and associated drives...
[ema@testlab:atelier-04] $ 

